<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>人际评分柱状图</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .chart-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        .controls {
            margin-bottom: 25px;
        }
        .select-wrapper {
            position: relative;
            display: inline-block;
            width: 220px;
        }
        select {
            width: 100%;
            padding: 10px 15px;
            font-size: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: white;
            appearance: none;
            -webkit-appearance: none;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        select:hover {
            border-color: #bdbdbd;
        }
        select:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.2);
        }
        .select-arrow {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            transition: transform 0.3s ease;
            color: #666;
        }
        select:focus + .select-arrow {
            transform: translateY(-50%) rotate(180deg);
            color: #4CAF50;
        }
        .chart-title {
            margin-bottom: 20px;
            font-size: 22px;
            font-weight: bold;
            color: #333;
        }
        .bar-chart {
            margin-top: 20px;
            position: relative;
            min-height: 400px;
        }
        .bar-item {
            position: absolute;
            width: 100%;
            transition: transform 0.8s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.5s ease;
            will-change: transform;
        }
        .name-label {
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
            font-size: 15px;
            transition: color 0.3s ease;
        }
        .bar-value-container {
            height: 32px;
            background-color: #f5f5f5;
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }
        .bar-value {
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 12px;
            color: white;
            font-weight: bold;
            transition: width 1s cubic-bezier(0.25, 0.1, 0.25, 1);
            min-width: 40px;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
            transform-origin: left center;
        }
        .bar-value.animating {
            animation: scaleIn 0.8s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
        }
        @keyframes scaleIn {
            0% { transform: scaleX(0); opacity: 0; }
            100% { transform: scaleX(1); opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="chart-container">
        <div class="chart-title">人际评分可视化</div>
        <div class="controls">
            <label for="sort-by" style="display: block; margin-bottom: 10px; font-size: 15px;">排序依据：</label>
            <div class="select-wrapper">
                <select id="sort-by">
                    <option value="总分">总分</option>
                    <option value="信誉评分">信誉评分</option>
                    <option value="人品评分">人品评分</option>
                    <option value="执行力">执行力</option>
                    <option value="情绪稳定性">情绪稳定性</option>
                    <option value="爱好契合">爱好契合</option>
                </select>
                <div class="select-arrow">▼</div>
            </div>
        </div>
        <div class="bar-chart" id="chart"></div>
    </div>

    <script>
        // 原始数据
        const rawData = [
            {姓名: "庙里没有和尚", 信誉评分: 20, 人品评分: 20, 执行力: 19, 情绪稳定性: 19, 爱好契合: 20, 总分: 98},
            {姓名: "刘WJ", 信誉评分: 15, 人品评分: 16, 执行力: 15, 情绪稳定性: 6, 爱好契合: 10, 总分: 62},
            {姓名: "李XL", 信誉评分: 5, 人品评分: 12, 执行力: 10, 情绪稳定性: 10, 爱好契合: 7, 总分: 44},
            {姓名: "张Y", 信誉评分: 13, 人品评分: 11, 执行力: 13, 情绪稳定性: 14, 爱好契合: 7, 总分: 58},
            {姓名: "李ZG", 信誉评分: 12, 人品评分: 12, 执行力: 12, 情绪稳定性: 16, 爱好契合: 5, 总分: 57}
        ];

        // 最大分值
        const maxScores = {
            "总分": 100,
            "信誉评分": 20,
            "人品评分": 20,
            "执行力": 20,
            "情绪稳定性": 20,
            "爱好契合": 20
        };

        let currentSort = "总分";
        let barElements = {};
        const itemHeight = 60; // 每个条目的高度(包含间距)

        // 初始化图表
        function initChart() {
            renderChart(currentSort);
            
            // 下拉菜单交互
            const select = document.getElementById('sort-by');
            select.addEventListener('focus', function() {
                this.parentNode.querySelector('.select-arrow').style.color = '#4CAF50';
            });
            select.addEventListener('blur', function() {
                this.parentNode.querySelector('.select-arrow').style.color = '#666';
            });
            select.addEventListener('change', function() {
                currentSort = this.value;
                renderChart(currentSort);
            });
        }

        // 渲染图表
        function renderChart(sortBy) {
            const chartContainer = document.getElementById('chart');
            
            // 排序数据
            const sortedData = [...rawData].sort((a, b) => b[sortBy] - a[sortBy]);
            
            // 如果是第一次渲染
            if (Object.keys(barElements).length === 0) {
                createInitialBars(sortedData, sortBy);
                return;
            }
            
            // 更新图表
            updateBars(sortedData, sortBy);
        }

        // 创建初始柱状图
        function createInitialBars(data, sortBy) {
            const chartContainer = document.getElementById('chart');
            
            data.forEach((person, index) => {
                const barItem = document.createElement('div');
                barItem.className = 'bar-item';
                barItem.style.transform = `translateY(${index * itemHeight}px)`;
                barItem.style.opacity = '1';
                
                const nameLabel = document.createElement('div');
                nameLabel.className = 'name-label';
                nameLabel.textContent = person.姓名;
                barItem.appendChild(nameLabel);
                
                const barValueContainer = document.createElement('div');
                barValueContainer.className = 'bar-value-container';
                
                const barValue = document.createElement('div');
                barValue.className = 'bar-value animating';
                const percentage = (person[sortBy] / maxScores[sortBy]) * 100;
                barValue.style.width = `${percentage}%`;
                barValue.textContent = person[sortBy];
                barValueContainer.appendChild(barValue);
                
                barItem.appendChild(barValueContainer);
                chartContainer.appendChild(barItem);
                
                // 保存引用
                barElements[person.姓名] = {
                    element: barItem,
                    valueElement: barValue,
                    currentY: index * itemHeight,
                    targetY: index * itemHeight
                };
                
                // 动画结束后移除动画类
                setTimeout(() => {
                    barValue.classList.remove('animating');
                }, 800);
            });
        }

        // 更新柱状图
        function updateBars(sortedData, sortBy) {
            // 第一步：更新所有柱子的宽度
            sortedData.forEach(person => {
                const element = barElements[person.姓名];
                if (element) {
                    const percentage = (person[sortBy] / maxScores[sortBy]) * 100;
                    element.valueElement.textContent = person[sortBy];
                    element.valueElement.style.width = `${percentage}%`;
                    element.valueElement.classList.add('animating');
                    
                    // 动画结束后移除动画类
                    setTimeout(() => {
                        element.valueElement.classList.remove('animating');
                    }, 800);
                }
            });
            
            // 第二步：重新计算并设置每个柱子的位置
            sortedData.forEach((person, newIndex) => {
                const element = barElements[person.姓名];
                if (element) {
                    element.targetY = newIndex * itemHeight;
                    
                    // 如果位置发生变化，则设置新位置
                    if (element.currentY !== element.targetY) {
                        element.element.style.transform = `translateY(${element.targetY}px)`;
                        element.currentY = element.targetY;
                    }
                }
            });
        }

        // 初始化
        window.onload = initChart;
    </script>
</body>
</html>